# 仮想マシンのエクスポートとインポート

Hyper-V のエクスポート機能とインポート機能を使うと、仮想マシンを簡単に複製できます。 エクスポートした仮想マシンは、バックアップや、仮想マシンを Hyper-V ホスト間で移動する手段として使用することができます。

仮想マシンの復元にはインポートを使用します。 仮想マシンをインポートする前に、エクスポートする必要はありません。 インポートでは、利用できるあらゆるデータから仮想マシンの再作成が試みられます。 ファイルの場所は、**仮想マシンのインポート**ウィザードを使用して指定します。 これにより、仮想マシンが Hyper-V に登録され、使用できるようになります。

このドキュメントでは、仮想マシンをエクスポートとインポートする手順、およびこれらのタスクを実行する場合に可能な選択肢について説明します。

## 仮想マシンのエクスポート

### Hyper-V マネージャーの使用

仮想マシンのエクスポートを作成すると、すべての関連ファイルがエクスポートにバンドルされます。 エクスポートには、構成ファイル、ハード ドライブ ファイル、および既存のチェックポイント ファイルも含まれます。 仮想マシンのエクスポートを作成するには

1. Hyper-V マネージャーで、必要な仮想マシンを右クリックして、**[エクスポート]** を選択します。

2. エクスポートされたファイルを保存する場所を指定し、**[エクスポート]** ボタンをクリックします。

**注:** このプロセスは、開始または停止のいずれかの状態である仮想マシン上で実行できます。

エクスポートが完了すると、エクスポート場所にエクスポートされたファイルがすべて表示されます。

### PowerShell の使用

PowerShell を使用して仮想マシンをエクスポートするには、**Export-VM** コマンドを使用します。

```powershell
Export-VM -Name <vm name> -Path <path>
```

Windows PowerShell を使用して仮想マシンをエクスポートする方法の詳細については、「[EXPORT-VM](https://technet.microsoft.com/library/hh848491.aspx)」を参照してください。

## 仮想マシンのインポート

仮想マシンをインポートすると、仮想マシンが Hyper-V ホストに登録されます。 仮想マシンのエクスポートは、派生元のホストまたは新しいホストにインポートし直すことができます。

Hyper-V には、次の 3 種類のインポートがあります。

- **インプレース登録**: エクスポート ファイルは、仮想マシンを実行する必要のある場所に配置されています。 インポートすると、仮想マシンはエクスポート時と同じ ID を持ちます。 このため、仮想マシンが既に Hyper-V に登録されている場合、インポートが動作する前に、その仮想マシンを削除する必要があります。 インポートが完了すると、エクスポート ファイルは実行中の状態になり、削除することはできません。

- **仮想マシンを復元する** – 特定の場所に VM ファイルを保存するオプションを指定するか、Hyper-V の既定の場所を使用します。 このインポートの種類は、エクスポートするファイルのコピーを作成し、選択した場所にコピーを移動します。 インポートすると、仮想マシンはエクスポート時と同じ ID を持ちます。 このため、仮想マシンが既に Hyper-V で実行されている場合、インポートが完了する前に、その仮想マシンを削除する必要があります。 インポートが完了すると、エクスポートしたファイルはアンタッチのままになり、もう一度削除やインポートを行うことができます。

- **仮想マシンをコピーする** – このインポートの種類は、VM ファイル用に場所を選択する復元の種類と似ています。 インポートされたときに、仮想マシンに新しい一意の ID がある点が異なります。 この新しい ID を使うと、仮想マシンを同じホストに複数回インポートできます。


### Hyper-V マネージャーの使用

仮想マシンを Hyper-V ホストにインポートするには

1. Hyper-V マネージャーで、[アクション] メニューから **[仮想マシンのインポート]** をクリックします。

2. [開始する前に] 画面上で **[次へ]** をクリックします。

3. エクスポートされたファイルのあるフォルダーを選択して、**[次へ]** をクリックします。

4. インポートする仮想マシンを選択すると、1 つのみのオプションが存在するはずです。

5. 3 つのオプションからいずれか 1 つのインポートの種類を選択し、[次へ] をクリックします。

6. 概要の画面で **[完了]** を選択します。

仮想マシンのインポート ウィザードでは、仮想マシンを新しいホストにインポートする際に非互換性に対応する手順も説明します。そのためこのウィザードでは、メモリ、仮想スイッチ、仮想プロセッサなど、物理ハードウェアに関連する構成を行うことができます。

仮想マシンをインポートする場合、ウィザードによって次の手順が実行されます。
1. 仮想マシン構成ファイルのコピーを作成します。 これは、停電などにより、ホストで予期せず再起動が行われる場合の予防措置として行われます。

2. ハードウェアを検証します。 仮想マシンの構成ファイルの情報と新しいホストのハードウェアを比較します。

3. エラーの一覧を作成します。 この一覧には再構成が必要な項目が示されており、それによって次にウィザードに表示されるページが決まります。

4. 一度に 1 つのカテゴリずつ、関連ページが表示されます。 このウィザードでは、新しいホストとの互換性を確保するために仮想マシンを再構成できるように、各非互換性について説明します。

5. 構成ファイルのコピーを削除します。 この処理が完了すると、仮想マシンが起動可能な状態になります。


### PowerShell の使用

PowerShell を使用して仮想マシンをインポートするには、**Import-VM** コマンドを使用します。 次のコマンドでは、PowerShell を使用して 3 つの種類のインポートについてそれぞれ 1 つのインポートを行います。

仮想マシンのインプレース インポートを完了する場合、コマンドは次のようになります。 インポート時に保存された場所のファイルを使用して、仮想マシン ID を保持するインプレース インポートを取り消します。

```powershell
Import-VM -Path 'C:\<emport path>\2B91FEB3-F1E0-4FFF-B8BE-29CED892A95A.vmcx' 
```

仮想マシン用に独自のパスを指定して、仮想マシンをインポートする場合、コマンドは次のようになります。

```powershell
Import-VM -Path ‘C:\<vm export path>\2B91FEB3-F1E0-4FFF-B8BE-29CED892A95A.vmcx' -Copy -VhdDestinationPath 'D:\Virtual Machines\WIN10DOC' -VirtualMachinePath 'D:\Virtual Machines\WIN10DOC'
```

コピーのインポートを完了して、仮想マシン ファイルを既定の Hyper-V の場所に移動する場合、コマンドは次のようになります。

``` PowerShell
Import-VM -Path 'C:\<vm export path>\2B91FEB3-F1E0-4FFF-B8BE-29CED892A95A.vmcx' –Copy -GenerateNewId
```

詳細については、「[Import-VM](https://technet.microsoft.com/library/hh848495.aspx)」を参照してください。



